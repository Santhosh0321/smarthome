<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SentinelHome - Instant Control</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c1f 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .header h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .connection-status {
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .status-connected {
            background: rgba(76,175,80,0.2);
            color: #4caf50;
            border: 1px solid #4caf50;
        }
        
        .status-disconnected {
            background: rgba(244,67,54,0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }
        
        .latency-badge {
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 0.9em;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .card-header h3 {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .relay-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .relay-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .led.on {
            background: #4caf50;
            box-shadow: 0 0 15px #4caf50;
        }
        
        .led.off {
            background: #f44336;
        }
        
        .led.emergency {
            background: #ff9800;
            box-shadow: 0 0 15px #ff9800;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f44336;
            transition: .3s;
            border-radius: 30px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4caf50;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .sensor-row {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sensor-value {
            font-weight: bold;
            color: #4caf50;
        }
        
        .emergency-banner {
            background: rgba(244,67,54,0.3);
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° SentinelHome Instant Control</h1>
            <div style="display: flex; gap: 15px;">
                <div id="connectionStatus" class="connection-status status-disconnected">
                    üî¥ Disconnected
                </div>
                <div class="latency-badge">
                    ‚ö° <span id="latency">0</span>ms
                </div>
            </div>
        </div>
        
        <div id="emergencyBanner" style="display: none;" class="emergency-banner">
            üö®üö® FIRE EMERGENCY ACTIVE! üö®üö®<br>
            Manual control disabled
        </div>
        
        <!-- Relay Controls -->
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h3>üí° Light (Relay 1)</h3>
                </div>
                <div class="relay-row">
                    <div class="relay-info">
                        <span id="relay1Led" class="led off"></span>
                        <span id="relay1Status">OFF</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="relay1Toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>üåÄ Fan (Relay 2)</h3>
                </div>
                <div class="relay-row">
                    <div class="relay-info">
                        <span id="relay2Led" class="led off"></span>
                        <span id="relay2Status">OFF</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="relay2Toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>üíß Motor (Relay 3)</h3>
                </div>
                <div class="relay-row">
                    <div class="relay-info">
                        <span id="relay3Led" class="led off"></span>
                        <span id="relay3Status">OFF</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="relay3Toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>‚ö° Emergency (Relay 4)</h3>
                </div>
                <div class="relay-row">
                    <div class="relay-info">
                        <span id="relay4Led" class="led off"></span>
                        <span id="relay4Status">OFF</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="relay4Toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Sensors -->
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h3>üå°Ô∏è Environmental</h3>
                </div>
                <div class="sensor-row">
                    <span>Temperature</span>
                    <span class="sensor-value" id="temperature">--¬∞C</span>
                </div>
                <div class="sensor-row">
                    <span>Humidity</span>
                    <span class="sensor-value" id="humidity">--%</span>
                </div>
                <div class="sensor-row">
                    <span>Light Level</span>
                    <span class="sensor-value" id="lightLevel">--%</span>
                </div>
                <div class="sensor-row">
                    <span>Water Level</span>
                    <span class="sensor-value" id="waterLevel">--%</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>‚ö†Ô∏è Hazards</h3>
                </div>
                <div class="sensor-row">
                    <span>üî• Fire</span>
                    <span class="sensor-value" id="fireStatus">No</span>
                </div>
                <div class="sensor-row">
                    <span>üí® Smoke</span>
                    <span class="sensor-value" id="smokeStatus">No</span>
                </div>
                <div class="sensor-row">
                    <span>üåßÔ∏è Rain</span>
                    <span class="sensor-value" id="rainStatus">No</span>
                </div>
                <div class="sensor-row">
                    <span>üö∂ Motion</span>
                    <span class="sensor-value" id="motionStatus">No</span>
                </div>
                <div class="sensor-row">
                    <span>üì≥ Vibration</span>
                    <span class="sensor-value" id="vibrationStatus">0</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>üîî Buzzer</h3>
                </div>
                <div class="sensor-row">
                    <span>Status</span>
                    <span class="sensor-value" id="buzzerActive">Inactive</span>
                </div>
                <div class="sensor-row">
                    <span>Reason</span>
                    <span class="sensor-value" id="buzzerReason">--</span>
                </div>
                <div class="relay-row">
                    <span>Manual Control</span>
                    <label class="switch">
                        <input type="checkbox" id="buzzerToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <div class="footer">
            ‚ö° Instant Control - Changes happen in milliseconds!
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCLdL4teSGiF8f0M5q9LaXoXd1mPoq9lMY",
            authDomain: "smart-home-dd7e5.firebaseapp.com",
            databaseURL: "https://smart-home-dd7e5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "smart-home-dd7e5",
            storageBucket: "smart-home-dd7e5.firebasestorage.app",
            messagingSenderId: "230561792370",
            appId: "1:230561792370:web:f951f576564cb076401deb"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let lastUpdateTime = Date.now();
        
        // Connection Status
        const connectionStatus = document.getElementById('connectionStatus');
        const latencySpan = document.getElementById('latency');
        
        db.ref('.info/connected').on('value', (snap) => {
            if (snap.val()) {
                connectionStatus.className = 'connection-status status-connected';
                connectionStatus.innerHTML = 'üü¢ Connected';
                measureLatency();
            } else {
                connectionStatus.className = 'connection-status status-disconnected';
                connectionStatus.innerHTML = 'üî¥ Disconnected';
            }
        });
        
        function measureLatency() {
            const start = Date.now();
            db.ref('.info/connected').once('value', () => {
                const latency = Date.now() - start;
                latencySpan.textContent = latency;
            });
            setTimeout(measureLatency, 2000);
        }
        
        // Monitor Emergency Status
        db.ref('/system/emergencyActive').on('value', (snapshot) => {
            const active = snapshot.val();
            document.getElementById('emergencyBanner').style.display = active ? 'block' : 'none';
        });
        
        // Relay Controls - INSTANT updates
        for (let i = 1; i <= 4; i++) {
            db.ref(`/relay${i}`).on('value', (snapshot) => {
                const state = snapshot.val();
                lastUpdateTime = Date.now();
                
                document.getElementById(`relay${i}Status`).textContent = state ? 'ON' : 'OFF';
                document.getElementById(`relay${i}Led`).className = state ? 'led on' : 'led off';
                
                const toggle = document.getElementById(`relay${i}Toggle`);
                if (toggle.checked !== state) {
                    toggle.checked = state;
                }
            });
            
            document.getElementById(`relay${i}Toggle`).addEventListener('change', (e) => {
                const newState = e.target.checked;
                db.ref(`/relay${i}`).set(newState);
                
                document.getElementById(`relay${i}Status`).textContent = newState ? 'ON' : 'OFF';
                document.getElementById(`relay${i}Led`).className = newState ? 'led on' : 'led off';
            });
        }
        
        // Buzzer Control
        db.ref('/buzzer').on('value', (snapshot) => {
            const state = snapshot.val();
            document.getElementById('buzzerToggle').checked = state;
        });
        
        document.getElementById('buzzerToggle').addEventListener('change', (e) => {
            db.ref('/buzzer').set(e.target.checked);
        });
        
        // Monitor all sensors
        db.ref('/sensors').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            
            document.getElementById('temperature').textContent = (data.temperature || 0).toFixed(1) + '¬∞C';
            document.getElementById('humidity').textContent = (data.humidity || 0).toFixed(1) + '%';
            document.getElementById('lightLevel').textContent = (data.light || 0) + '%';
            document.getElementById('waterLevel').textContent = (data.water || 0) + '%';
            
            document.getElementById('fireStatus').textContent = data.fire ? 'üî• DETECTED' : 'No';
            document.getElementById('smokeStatus').textContent = data.smoke ? 'üí® DETECTED' : 'No';
            document.getElementById('rainStatus').textContent = data.rain ? 'üåßÔ∏è YES' : 'No';
            document.getElementById('motionStatus').textContent = data.motion ? 'üö∂ YES' : 'No';
            
            document.getElementById('vibrationStatus').textContent = data.vibrationCount || 0;
            
            document.getElementById('buzzerActive').textContent = data.buzzerActive ? 'ACTIVE' : 'Inactive';
            document.getElementById('buzzerReason').textContent = data.buzzerReason || '--';
        });
        
        console.log('‚úÖ Instant Control Dashboard Ready');
    </script>
</body>
</html>
